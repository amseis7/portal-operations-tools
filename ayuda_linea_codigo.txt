Logica para poder administrar el permisos de las herramientas que se subiran
{% if 'virustotal' in current_user.authorized_tools %}
   {% endif %}
############################################################################################################
--- Crear base de datos y cuenta admin ---

from app import db
from app.models import User, Notification # Importamos Notification tambi√©n para que cree la tabla

# 1. Crear todas las tablas vac√≠as (Alerta, User, Ioc, Notification)
db.create_all()

# 2. Crear el Super Admin
admin = User(
    username='admin', 
    nombre_completo='Administrador Principal', 
    email='admin@csirt.local', 
    is_admin=True, 
    authorized_tools='all'
)

# 3. Contrase√±a
admin.set_password('admin123')

# 4. Guardar
db.session.add(admin)
db.session.commit()

print(f"Base de datos regenerada y usuario '{admin.username}' creado.")
############################################################################################################
--- Eliminar alertas gestionado sin IoC ---

from app import db
from app.models import Alerta

# 1. Identificar alertas que NO tienen hijos en la lista 'iocs'
alertas_vacias = [a for a in Alerta.query.all() if not a.iocs]

print(f"Se encontraron {len(alertas_vacias)} alertas sin IoCs.")

# 2. Borrado Masivo
for alerta in alertas_vacias:
    db.session.delete(alerta)

db.session.commit()
print("Limpieza completada: Se eliminaron las alertas vac√≠as.")
############################################################################################################

docker build -t operations_tools:v1 .

docker run -d -p 8080:8080 --name portal_tools -v "%cd%":/app operations_tools:v1

1. Ver si est√° corriendo:
docker ps

2. Ver qu√© est√° pasando (Logs/Errores):
docker logs -f portal_v4
(Usa Ctrl+C para salir de los logs sin apagar el servidor).

3. Apagar y Prender:
docker stop portal_v4
docker start portal_v4

4. Actualizar el C√≥digo (Cuando agregues VirusTotal):
Editas tu c√≥digo en PyCharm.
Construyes la imagen nueva: docker build -t portal:v5 .
Borras el contenedor viejo: docker rm -f portal_v4
Corres el nuevo (la DB se mantiene sola gracias al volumen): docker run ... portal:v5

############################################################################################################

Ciclo de Vida: Despliegue y Actualizaci√≥n
FASE 1: El Despliegue Inicial (Hoy)
Vas a llevar tu versi√≥n 1.0.0 al servidor.

1. En tu Notebook (Local): Empaqueta tu imagen actual.
# Aseg√∫rate de que la imagen existe (docker images)
docker save -o portal_v1.tar portal-operations-tools:v4

2. Transferencia: 
Lleva el archivo portal_v1.tar al servidor (USB, Red, etc.). 
Recomendaci√≥n: Crea una carpeta en el servidor, ej: C:\Sistemas\Portal_CSIRT. Pon el archivo ah√≠.

3. En el Servidor (Producci√≥n): Abre la terminal en esa carpeta y ejecuta:
# 1. Cargar la imagen al Docker del servidor
docker load -i portal_v1.tar

# 2. Ejecutar el contenedor (Crear√° la DB ah√≠ mismo)
docker run -d -p 8080:8080 --name portal_prod --restart unless-stopped -v "%cd%":/app portal-operations-tools:v4 #Windows
docker run -d -p 8080:8080 --name <Nombre container> --restart unless-stopped -v <Nombre DB>:/app/instance <Nombre de imagen>:<version Tag> #Linux
(Nota: Agregu√© --restart unless-stopped. Si el servidor se reinicia, tu web arranca sola).

FASE 2: La Actualizaci√≥n (Cuando agregues VirusTotal)
Aqu√≠ es donde brilla tu elecci√≥n. Cuando tengas lista la v1.1.0 con VirusTotal en tu notebook:

1. En tu Notebook (Local):
Modificas c√≥digo.
Construyes nueva imagen: docker build -t portal:v2 .
Exportas: docker save -o portal_v2.tar portal:v2

2. En el Servidor (Producci√≥n): Llevas el archivo portal_v2.tar a la misma carpeta C:\Sistemas\Portal_CSIRT.
# 1. Cargar la nueva imagen
docker load -i portal_v2.tar

# 2. Detener y borrar el contenedor viejo (¬°Tranquilo, la DB est√° a salvo en la carpeta!)
docker stop portal_prod
docker rm portal_prod

# 3. Correr el nuevo apuntando A LA MISMA CARPETA
docker run -d -p 8080:8080 --name portal_prod --restart unless-stopped -v "%cd%":/app portal:v2
El Resultado: El sistema arranca con el c√≥digo nuevo (VirusTotal) pero se conecta a la base de datos vieja (app.db que est√° en C:\Sistemas\Portal_CSIRT). ¬°Tus usuarios ni se dar√°n cuenta, pero tendr√°n funciones nuevas y todos sus datos hist√≥ricos!

‚úÖ Lista de Tareas Final
Genera tu .tar ahora mismo.

Ll√©valo al servidor.

Ejecuta el comando de carga y ejecuci√≥n.

Abre el navegador del servidor (o desde tu PC apuntando a la IP del servidor) y disfruta de tu creaci√≥n.

############################################################################################################
¬°Comprendido perfectamente! Es una decisi√≥n muy pragm√°tica.

Mantenerlo en HTTP (Puerto 8080) por ahora te da la flexibilidad de moverte entre Linux y Windows Server sin tener que reconfigurar certificados, rutas de archivos ni permisos extra√±os. La belleza de Docker es que el contenedor no sabe (ni le importa) si est√° corriendo sobre un ping√ºino (Linux) o una ventana (Windows).

Para cerrar esta etapa y dejarte listo para desplegar sea donde sea, te dejo el "Archivo Maestro" (docker-compose.yml) para la versi√≥n HTTP.

Este archivo reemplaza al comando largo docker run ... y funcionar√° id√©ntico en Linux o Windows.

üîÑ C√≥mo usarlo (Linux o Windows)
El proceso es universal:

Cargas la imagen:

Bash

docker load -i portal_v1.tar
Creas el volumen (solo la primera vez):

Bash

docker volume create portal_db
Arrancas el sistema: En la misma carpeta donde est√° el docker-compose.yml:

Bash

docker compose up -d

############################################################################################################
